<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.lckof.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"fold":{"enable":true,"height":500,"threshold":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="想看看过去某天的微博热搜是什么，网上搜了下发现一个网站：热搜时光机。">
<meta property="og:type" content="article">
<meta property="og:title" content="破解微博热搜时光机">
<meta property="og:url" content="https://blog.lckof.com/2024/05/08/hack-weibotop/index.html">
<meta property="og:site_name" content="Tasty Pub">
<meta property="og:description" content="想看看过去某天的微博热搜是什么，网上搜了下发现一个网站：热搜时光机。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.lckof.com/2024/05/08/hack-weibotop/breakpoint.png">
<meta property="og:image" content="https://blog.lckof.com/2024/05/08/hack-weibotop/search-currentitems.png">
<meta property="article:published_time" content="2024-05-08T07:11:29.000Z">
<meta property="article:modified_time" content="2024-05-08T09:05:48.515Z">
<meta property="article:author" content="lckof">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.lckof.com/2024/05/08/hack-weibotop/breakpoint.png">


<link rel="canonical" href="https://blog.lckof.com/2024/05/08/hack-weibotop/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.lckof.com/2024/05/08/hack-weibotop/","path":"2024/05/08/hack-weibotop/","title":"破解微博热搜时光机"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>破解微博热搜时光机 | Tasty Pub</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<!-- ms clarity -->    
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "lbt0m726h2");
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-34Y9Q8PYBQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-34Y9Q8PYBQ');
</script>
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Tasty Pub</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E6%8E%A2"><span class="nav-number">1.</span> <span class="nav-text">初探</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="nav-number">2.</span> <span class="nav-text">查看网络请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A0%B4%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">破解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E6%B7%B7%E6%B7%86"><span class="nav-number">3.1.</span> <span class="nav-text">反混淆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.</span> <span class="nav-text">模块结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86"><span class="nav-number">3.3.</span> <span class="nav-text">解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E8%A7%A3%E5%AF%86"><span class="nav-number">3.4.</span> <span class="nav-text">验证解密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3"><span class="nav-number">3.5.</span> <span class="nav-text">时间戳</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%8A%A0%E5%AF%86"><span class="nav-number">3.6.</span> <span class="nav-text">验证加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%97%B6%E7%83%AD%E8%AF%8D"><span class="nav-number">3.7.</span> <span class="nav-text">实时热词</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E4%B8%9A"><span class="nav-number">3.8.</span> <span class="nav-text">作业</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lckof</p>
  <div class="site-description" itemprop="description">啊咧</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">209</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lckof.com/2024/05/08/hack-weibotop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lckof">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tasty Pub">
      <meta itemprop="description" content="啊咧">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="破解微博热搜时光机 | Tasty Pub">
      <meta itemprop="description" content="想看看过去某天的微博热搜是什么，网上搜了下发现一个网站：热搜时光机。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          破解微博热搜时光机
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-05-08 15:11:29 / 修改时间：17:05:48" itemprop="dateCreated datePublished" datetime="2024-05-08T15:11:29+08:00">2024-05-08</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">想看看过去某天的微博热搜是什么，网上搜了下发现一个网站：热搜时光机。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><a target="_blank" rel="noopener" href="https://www.weibotop.cn/">热搜时光机</a>应该是有在按分钟爬取<a target="_blank" rel="noopener" href="https://s.weibo.com/top/summary?cate=realtimehot">微博实时热搜</a>，入库后再提供界面给用户查询。</p>
<p>虽然能够免费使用，但使用网页的方式还是有点局限，想看看它能不能支持 api 访问，于是有了这篇文章。</p>
<h2 id="初探"><a href="#初探" class="headerlink" title="初探"></a>初探</h2><p>首先按下 F12 打开浏览器的开发者工具。立即发现调试程序已暂停，无法进行查看网络请求等操作。</p>
<img src="/2024/05/08/hack-weibotop/breakpoint.png" class="" title="断点">

<p>好嘛，为了防止其他开发者破解，搞得这么严实吗，这反而激起了我奇怪的好胜心。</p>
<p>通过断点所提示的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> <span class="title function_">anonymous</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">debugger</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>以及 callstack 调用堆栈，很容易发现作者加了这么一段：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Function</span>(<span class="string">&#x27;Function(arguments[0]+&quot;bugger&quot;)()&#x27;</span>)(<span class="string">&quot;de&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br></pre></td></tr></table></figure>

<p>利用的是<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/debugger">debugger</a>在声明时默认会触发调试器断点，这一步操作应该就能挡住非开发者的窥视。</p>
<p>我们取消<code>Pause on debugger statement</code>或者干脆停用断点后，选择恢复脚本执行（F8）即可跳过这段。</p>
<h2 id="查看网络请求"><a href="#查看网络请求" class="headerlink" title="查看网络请求"></a>查看网络请求</h2><p>随便修改一下时间，查看网页上的网络请求。可以看到有两次请求：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://api.weibotop.cn/getclosesttime?timestamp=lKAKyrL4a6BgfTZtBPfr7sT5QWj+ZtF/nVXIqQgJKw8=">https://api.weibotop.cn/getclosesttime?timestamp=lKAKyrL4a6BgfTZtBPfr7sT5QWj%2BZtF%2FnVXIqQgJKw8%3D</a></li>
<li><a target="_blank" rel="noopener" href="https://api.weibotop.cn/currentitems?timeid=Jf/nb+7htC8C6fsg3kkuqw==">https://api.weibotop.cn/currentitems?timeid=Jf%2Fnb%2B7htC8C6fsg3kkuqw%3D%3D</a></li>
</ul>
<p>从字面意思看，<code>getclosesttime</code>应该是将用户输入的时间转换成数据库中有数据的最接近的时间，<code>currentitems</code>则是拉取热搜数据。</p>
<p>这两个链接并没有对 http header 做判断，任何人直接访问这个 api 都可以获取结果，你可以点击链接试一试。作者应该是加密了<code>timestamp</code>和<code>timeid</code>参数来避免 api 被滥用。</p>
<h2 id="破解"><a href="#破解" class="headerlink" title="破解"></a>破解</h2><p>查看脚本，能发现网站就只有两个 js 脚本。一个是 main.js，另一个是 vue 库。</p>
<p>打开 main.js，搜索<code>currentitems</code>关键字，可以直接找到。</p>
<img src="/2024/05/08/hack-weibotop/search-currentitems.png" class="" title="搜索 currentitems">

<p>这么看作者并没有做增强混淆，只是做了常规的<a target="_blank" rel="noopener" href="https://github.com/terser/terser">最小化</a>，反混淆并不是必须。但为了可读性更好，我们仍然可以跑一次反混淆。</p>
<h3 id="反混淆"><a href="#反混淆" class="headerlink" title="反混淆"></a>反混淆</h3><p>虽然使用 Edge 打开源代码后会自动格式化，但 Firefox 和 Chrome 不行（怎么感觉反过来了），就算不用反混淆也需要做个简单的格式化。</p>
<p>反混淆可以使用<a target="_blank" rel="noopener" href="https://github.com/kuizuo/js-deobfuscator">开源项目</a><a target="_blank" rel="noopener" href="https://deobfuscator.kuizuo.cn/">js-deobfuscator</a>，效果并不是很好，但聊胜于无吧。</p>
<p>反混淆后使用<a target="_blank" rel="noopener" href="https://code.visualstudio.com/">vscode</a>打开，选择语言为<code>javascript</code>，这样就可以使用 IDE 的代码跳转功能（比如跳转到定义、跳转到引用）。</p>
<p><strong>currentitems</strong></p>
<p>首先搜索<code>currentitems</code>，能够找到<code>let o = &quot;https://api.weibotop.cn/currentitems&quot;</code>。</p>
<p>通过<code>o</code>，可以找到它的调用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i != <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="title function_">e</span>().<span class="title function_">get</span>(</span><br><span class="line">    o,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">timeid</span>: i,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">t</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> e = <span class="title function_">h</span>(t);</span><br><span class="line">      <span class="title function_">n</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">e</span>().<span class="title function_">get</span>(o, <span class="keyword">function</span> (<span class="params">t</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> e = <span class="title function_">h</span>(t);</span><br><span class="line">    <span class="title function_">n</span>(e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模块结构"><a href="#模块结构" class="headerlink" title="模块结构"></a>模块结构</h3><p>先看一下函数<code>e()</code>是什么：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t = <span class="title function_">i</span>(<span class="number">755</span>);</span><br><span class="line"><span class="keyword">var</span> e = i.<span class="title function_">n</span>(t);</span><br></pre></td></tr></table></figure>

<p>再看一下函数<code>i()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> e = &#123;&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">i</span>(<span class="params">n</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> o = e[n];</span><br><span class="line">  <span class="keyword">if</span> (o !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> o.<span class="property">exports</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> r = (e[n] = &#123;</span><br><span class="line">    <span class="attr">exports</span>: &#123;&#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  t[n].<span class="title function_">call</span>(r.<span class="property">exports</span>, r, r.<span class="property">exports</span>, i);</span><br><span class="line">  <span class="keyword">return</span> r.<span class="property">exports</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来<code>i()</code>是<a target="_blank" rel="noopener" href="https://gist.github.com/bndynet/30d1bb41b410a022919e87780ae0d62a">类似 UMD 标准</a>的一个 wrapper，本质上<code>i(755)</code>就是调用<code>t[755]</code>。我们可以发现<code>t</code>就是最外层的对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> t = &#123;</span><br><span class="line">    <span class="number">734</span>: <span class="keyword">function</span> (<span class="params">t, e, i</span>) &#123;</span><br><span class="line">      (<span class="keyword">function</span> (<span class="params">t, e, i</span>) &#123;</span><br><span class="line">        <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">n</span>(<span class="params">t</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (t &amp;&amp; <span class="keyword">typeof</span> t == <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="string">&quot;default&quot;</span> <span class="keyword">in</span> t) &#123;</span><br></pre></td></tr></table></figure>

<p><code>t[755]</code>是这个函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">755</span>: <span class="keyword">function</span> (<span class="params">t, e</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> i;</span><br><span class="line">  (<span class="keyword">function</span> (<span class="params">e, i</span>) &#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> t.<span class="property">exports</span> == <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">      t.<span class="property">exports</span> = e.<span class="property">document</span> ? <span class="title function_">i</span>(e, <span class="literal">true</span>) : <span class="keyword">function</span> (<span class="params">t</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!t.<span class="property">document</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;jQuery requires a window with a document&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">i</span>(t);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">i</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)(<span class="keyword">typeof</span> <span class="variable language_">window</span> != <span class="string">&quot;undefined&quot;</span> ? <span class="variable language_">window</span> : <span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">n, o</span>) &#123;</span><br></pre></td></tr></table></figure>

<p>到这已经很看出来，<code>i(755)</code>就是<code>jQuery</code>，上面的代码就变成了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">get</span>(<span class="string">&quot;https://api.weibotop.cn/currentitems&quot;</span>, <span class="keyword">function</span> (<span class="params">t</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> e = <span class="title function_">h</span>(t);</span><br><span class="line">  <span class="title function_">n</span>(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><p>再找到函数<code>h()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">t</span>) &#123;</span><br><span class="line">  i = t = <span class="title class_">String</span>(t);</span><br><span class="line">  o = n.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">parse</span>(i);</span><br><span class="line">  r = a;</span><br><span class="line">  <span class="keyword">let</span> e = n.<span class="property">AES</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">ciphertext</span>: o,</span><br><span class="line">    &#125;,</span><br><span class="line">    r,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">mode</span>: n.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">      <span class="attr">padding</span>: n.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ).<span class="title function_">toString</span>(n.<span class="property">enc</span>.<span class="property">Utf8</span>);</span><br><span class="line">  <span class="keyword">var</span> i;</span><br><span class="line">  <span class="keyword">var</span> o;</span><br><span class="line">  <span class="keyword">var</span> r;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从函数<code>h()</code>很明显很看出，它使用了<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">AES 解密</a>。关键在于密钥，也就是函数里的<code>a</code>。</p>
<p>我们接着看一下<code>a</code>是什么：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = n.<span class="title class_">SHA1</span>(n.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;tSdGtmwh49BcR1irt18mxG41dGsBuGKS&quot;</span>));</span><br><span class="line"><span class="keyword">let</span> a = n.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(s.<span class="title function_">toString</span>(n.<span class="property">enc</span>.<span class="property">Hex</span>).<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">32</span>));</span><br></pre></td></tr></table></figure>

<p>好了，基本结束了。密钥并没有使用特别恶心的混淆，明文写在了代码里。盲猜<code>n</code>就是<a target="_blank" rel="noopener" href="https://github.com/brix/crypto-js">crypto-js</a>，验证一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="title function_">i</span>(<span class="number">354</span>);</span><br></pre></td></tr></table></figure>

<p><code>i(354)</code> 是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">354</span>: <span class="keyword">function</span> (<span class="params">t, e, i</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> n;</span><br><span class="line">  n = <span class="title function_">i</span>(<span class="number">249</span>);</span><br><span class="line">  <span class="title function_">i</span>(<span class="number">938</span>);</span><br><span class="line">  <span class="title function_">i</span>(<span class="number">433</span>);</span><br><span class="line">  <span class="title function_">i</span>(<span class="number">298</span>);</span><br><span class="line">  <span class="comment">// 此处省略一部分无效代码</span></span><br><span class="line">  t.<span class="property">exports</span> = n;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>这里作者很敷衍的做了点误导，再看一下<code>i(249)</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">249</span>: <span class="keyword">function</span> (<span class="params">t, e, i</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> n;</span><br><span class="line">  t.<span class="property">exports</span> = n = n || <span class="keyword">function</span> (<span class="params">t, e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> n;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> != <span class="string">&quot;undefined&quot;</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">crypto</span>) &#123;</span><br><span class="line">      n = <span class="variable language_">window</span>.<span class="property">crypto</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!n &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">window</span> != <span class="string">&quot;undefined&quot;</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">msCrypto</span>) &#123;</span><br><span class="line">      n = <span class="variable language_">window</span>.<span class="property">msCrypto</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!n &amp;&amp; i.<span class="property">g</span> !== <span class="literal">undefined</span> &amp;&amp; i.<span class="property">g</span>.<span class="property">crypto</span>) &#123;</span><br><span class="line">      n = i.<span class="property">g</span>.<span class="property">crypto</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!n) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        n = <span class="title function_">i</span>(<span class="title class_">Object</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> t = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Cannot find module &#x27;crypto&#x27;&quot;</span>);</span><br><span class="line">          t.<span class="property">code</span> = <span class="string">&quot;MODULE_NOT_FOUND&quot;</span>;</span><br><span class="line">          <span class="keyword">throw</span> t;</span><br><span class="line">        &#125;()));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (t) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">o</span>(<span class="params"></span>) &#123;</span><br></pre></td></tr></table></figure>

<p>破案，就是<code>crypto-js</code>。</p>
<h3 id="验证解密"><a href="#验证解密" class="headerlink" title="验证解密"></a>验证解密</h3><p>随手写一段代码来验证一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Crypto</span> = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cryptedText = <span class="string">&quot;此处贴入/currentitems返回的字符串&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = <span class="title class_">Crypto</span>.<span class="title class_">SHA1</span>(</span><br><span class="line">  <span class="title class_">Crypto</span>.<span class="property">enc</span>.<span class="property">Utf8</span>.<span class="title function_">parse</span>(<span class="string">&quot;tSdGtmwh49BcR1irt18mxG41dGsBuGKS&quot;</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> a = <span class="title class_">Crypto</span>.<span class="property">enc</span>.<span class="property">Hex</span>.<span class="title function_">parse</span>(s.<span class="title function_">toString</span>(<span class="title class_">Crypto</span>.<span class="property">enc</span>.<span class="property">Hex</span>).<span class="title function_">substr</span>(<span class="number">0</span>, <span class="number">32</span>));</span><br><span class="line"><span class="keyword">const</span> o = <span class="title class_">Crypto</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">parse</span>(cryptedText);</span><br><span class="line"><span class="keyword">const</span> decryptedText = <span class="title class_">Crypto</span>.<span class="property">AES</span>.<span class="title function_">decrypt</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">ciphertext</span>: o,</span><br><span class="line">  &#125;,</span><br><span class="line">  a,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="title class_">Crypto</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">    <span class="attr">padding</span>: <span class="title class_">Crypto</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">  &#125;</span><br><span class="line">).<span class="title function_">toString</span>(<span class="title class_">Crypto</span>.<span class="property">enc</span>.<span class="property">Utf8</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(decryptedText));</span><br></pre></td></tr></table></figure>

<p>正确得到结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  [</span><br><span class="line">    <span class="string">&#x27;春晚节目&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2024-02-08 22:42:03.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2024-02-08 07:26:13.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1243383&#x27;</span></span><br><span class="line">  ],</span><br><span class="line">  [</span><br><span class="line">    <span class="string">&#x27;阿根廷3月中国行大概率取消&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2024-02-08 21:08:14.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2024-02-08 12:42:09.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1183235&#x27;</span></span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>

<p>解析格式是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">i.<span class="title function_">push</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: e[n][<span class="number">0</span>],</span><br><span class="line">  <span class="attr">uptime</span>: e[n][<span class="number">2</span>].<span class="title function_">replace</span>(<span class="regexp">/\.0/</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">  <span class="attr">downtime</span>: e[n][<span class="number">1</span>].<span class="title function_">replace</span>(<span class="regexp">/\.0/</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">  <span class="attr">hotindex</span>: e[n][<span class="number">3</span>],</span><br><span class="line">  <span class="attr">duration</span>:</span><br><span class="line">    ((o = e[n][<span class="number">2</span>].<span class="title function_">replace</span>(<span class="regexp">/\.0/</span>, <span class="string">&quot;&quot;</span>)),</span><br><span class="line">    (r = e[n][<span class="number">1</span>].<span class="title function_">replace</span>(<span class="regexp">/\.0/</span>, <span class="string">&quot;&quot;</span>)),</span><br><span class="line">    (s = <span class="literal">undefined</span>),</span><br><span class="line">    (s = <span class="keyword">new</span> <span class="title class_">Date</span>(r.<span class="title function_">replace</span>(<span class="regexp">/\s/</span>, <span class="string">&quot;T&quot;</span>)) - <span class="keyword">new</span> <span class="title class_">Date</span>(o.<span class="title function_">replace</span>(<span class="regexp">/\s/</span>, <span class="string">&quot;T&quot;</span>))),</span><br><span class="line">    (s = (s /= <span class="number">1000</span>).<span class="title function_">toString</span>()).<span class="title function_">toHHMMSS</span>()),</span><br><span class="line">  <span class="attr">rank</span>: n + <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>getclosesttime</strong></p>
<h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>再看一下对齐时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">d</span>(<span class="params">t, i = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">n</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> i = &#123;</span><br><span class="line">      <span class="attr">timeid</span>: e[<span class="number">0</span>],</span><br><span class="line">      <span class="attr">timestamp</span>: e[<span class="number">1</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">t</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ((i = <span class="title function_">l</span>(i)) == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="title function_">e</span>().<span class="title function_">getJSON</span>(<span class="string">&quot;https://api.weibotop.cn/getlatest&quot;</span>, n);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">e</span>().<span class="title function_">getJSON</span>(</span><br><span class="line">      <span class="string">&quot;https://api.weibotop.cn/getclosesttime&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">timestamp</span>: i,</span><br><span class="line">      &#125;,</span><br><span class="line">      n</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从这里可以看出，这两个 api 返回的是一个元组<code>[timeid, timestamp]</code>。比如<code>[&quot;1151626&quot;,&quot;2024-05-08 16:32:03.0&quot;]</code>。</p>
<p>我们接着看函数<code>l()</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">l</span>(<span class="params">t</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (t == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> e = t;</span><br><span class="line">  <span class="keyword">var</span> i = a;</span><br><span class="line">  <span class="keyword">var</span> o = n.<span class="property">AES</span>.<span class="title function_">encrypt</span>(e, i, &#123;</span><br><span class="line">    <span class="attr">mode</span>: n.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">    <span class="attr">padding</span>: n.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> n.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(o.<span class="property">ciphertext</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里也只是将<code>timestamp</code>做了个简单的加密，<code>timestamp</code>的取值为<code>w(e()(&quot;#selectDateTime&quot;).val());</code>。</p>
<p><code>#selectDateTime</code>是一个类型为<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local">datetime-local</a>的输入框，它的<code>val()</code>格式是<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Date_and_time_formats#local_date_and_time_strings">不带时区的时间字符串</a>，比如<code>2024-05-08T14:27:06</code>。</p>
<h3 id="验证加密"><a href="#验证加密" class="headerlink" title="验证加密"></a>验证加密</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plainText = <span class="string">&quot;2024-05-08T14:27:06&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = <span class="title class_">Crypto</span>.<span class="property">AES</span>.<span class="title function_">encrypt</span>(plainText, a, &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="title class_">Crypto</span>.<span class="property">mode</span>.<span class="property">ECB</span>,</span><br><span class="line">  <span class="attr">padding</span>: <span class="title class_">Crypto</span>.<span class="property">pad</span>.<span class="property">Pkcs7</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> encryptedText = <span class="title class_">Crypto</span>.<span class="property">enc</span>.<span class="property">Base64</span>.<span class="title function_">stringify</span>(o.<span class="property">ciphertext</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(encryptedText);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">encodeURIComponent</span>(encryptedText));</span><br></pre></td></tr></table></figure>

<p>得到结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lKAKyrL4a6BgfTZtBPfr7sT5QWj+<span class="title class_">ZtF</span>/nVXIqQgJKw8=</span><br><span class="line">lKAKyrL4a6BgfTZtBPfr7sT5QWj%2BZtF%2FnVXIqQgJKw8%3D</span><br></pre></td></tr></table></figure>

<p>与上面的<code>https://api.weibotop.cn/getclosesttime?timestamp=lKAKyrL4a6BgfTZtBPfr7sT5QWj%2BZtF%2FnVXIqQgJKw8%3D</code>一致。</p>
<p><code>getclosesttime</code>返回的对齐时间是<code>[&quot;1151567&quot;,&quot;2024-05-08 14:26:06.0&quot;]</code>，前面的<code>1151567</code>就是<code>timeid</code>。</p>
<p>我们将<code>timeid</code>进行加密，得到：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Jf</span>/nb+7htC8C6fsg3kkuqw==</span><br><span class="line"><span class="title class_">Jf</span>%2Fnb%2B7htC8C6fsg3kkuqw%3D%3D</span><br></pre></td></tr></table></figure>

<p>与上面的<code>https://api.weibotop.cn/currentitems?timeid=Jf%2Fnb%2B7htC8C6fsg3kkuqw%3D%3D</code>一致。</p>
<p>至此，破解大体完成。</p>
<h3 id="实时热词"><a href="#实时热词" class="headerlink" title="实时热词"></a>实时热词</h3><p>顺便，微博似乎开放了热词的 api：<a target="_blank" rel="noopener" href="https://weibo-info.oss-cn-shenzhen.aliyuncs.com/homekeywords.json%E3%80%82">https://weibo-info.oss-cn-shenzhen.aliyuncs.com/homekeywords.json。</a></p>
<p>可直接访问：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;榴莲&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;淘宝&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;男子&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;擦边&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;绑架勒索&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;王楚&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;续命&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;色弱&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;苗苗&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;产子&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;过万&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;张本&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;郑恺&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;如懿传&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;蔡少芬&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;iPad&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h3><p>这个网站还使用了一个搜索的 api：<a target="_blank" rel="noopener" href="https://api.weibotop.cn/search?searchstr=m7xb8CtLL8+hwqXG8XFAXA==%E3%80%82">https://api.weibotop.cn/search?searchstr=m7xb8CtLL8%2BhwqXG8XFAXA%3D%3D。</a></p>
<p>可以试着破解一下。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/05/07/web-interface-guidelines/" rel="prev" title="【翻译】Web界面开发指南">
                  <i class="fa fa-angle-left"></i> 【翻译】Web界面开发指南
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/05/13/backup-weixin-chat-history/" rel="next" title="备份微信聊天记录">
                  备份微信聊天记录 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">lckof</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"suyu0925/comments-for-blog","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
